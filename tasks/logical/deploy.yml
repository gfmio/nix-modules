# yaml-language-server: $schema=https://taskfile.dev/schema.json
# Taskfile for deployment tasks
# Learn more: https://taskfile.dev

version: '3'

tasks:
  deploy:nixos:
    desc: Deploy NixOS configuration to current host
    platforms: [linux]
    sources:
      - 'hosts/nixos/**/*.nix'
      - 'modules/**/*.nix'
      - 'flake.nix'
      - 'flake.lock'
    cmds:
      - echo "üöÄ Deploying NixOS configuration..."
      - sudo nixos-rebuild switch --flake .
      - echo "‚úÖ NixOS configuration deployed!"

  deploy:nixos:boot:
    desc: Deploy NixOS configuration and set as boot default
    platforms: [linux]
    sources:
      - 'hosts/nixos/**/*.nix'
      - 'modules/**/*.nix'
      - 'flake.nix'
      - 'flake.lock'
    cmds:
      - echo "üöÄ Deploying NixOS configuration (boot)..."
      - sudo nixos-rebuild boot --flake .
      - echo "‚úÖ NixOS configuration will be active on next boot!"

  deploy:darwin:
    desc: Deploy nix-darwin configuration to current host
    platforms: [darwin]
    sources:
      - 'hosts/nix-darwin/**/*.nix'
      - 'modules/**/*.nix'
      - 'flake.nix'
      - 'flake.lock'
    cmds:
      - echo "üöÄ Deploying nix-darwin configuration..."
      - darwin-rebuild switch --flake .
      - echo "‚úÖ nix-darwin configuration deployed!"

  deploy:home:
    desc: Deploy home-manager configuration for current user
    sources:
      - 'home/**/*.nix'
      - 'modules/home-manager/**/*.nix'
      - 'flake.nix'
      - 'flake.lock'
    cmds:
      - echo "üöÄ Deploying home-manager configuration..."
      - home-manager switch --flake .
      - echo "‚úÖ home-manager configuration deployed!"

  deploy:test:nixos:
    desc: Test NixOS configuration (build and activate, but don't set as boot default)
    platforms: [linux]
    sources:
      - 'hosts/nixos/**/*.nix'
      - 'modules/**/*.nix'
      - 'flake.nix'
      - 'flake.lock'
    cmds:
      - echo "üß™ Testing NixOS configuration..."
      - sudo nixos-rebuild test --flake .
      - echo "‚úÖ NixOS configuration tested and activated (not set as boot default)!"

  deploy:test:darwin:
    desc: Test nix-darwin configuration (check but don't activate)
    platforms: [darwin]
    sources:
      - 'hosts/nix-darwin/**/*.nix'
      - 'modules/**/*.nix'
      - 'flake.nix'
      - 'flake.lock'
    cmds:
      - echo "üß™ Testing nix-darwin configuration..."
      - darwin-rebuild check --flake .
      - echo "‚úÖ nix-darwin configuration tested!"

  deploy:dry-run:nixos:
    desc: Dry run NixOS deployment (show what would be built/changed)
    platforms: [linux]
    sources:
      - 'hosts/nixos/**/*.nix'
      - 'modules/**/*.nix'
      - 'flake.nix'
      - 'flake.lock'
    cmds:
      - echo "üîç Dry run NixOS deployment..."
      - sudo nixos-rebuild dry-build --flake .
      - echo "‚úÖ Dry run complete!"

  deploy:dry-run:darwin:
    desc: Dry run nix-darwin deployment (build but don't activate)
    platforms: [darwin]
    sources:
      - 'hosts/nix-darwin/**/*.nix'
      - 'modules/**/*.nix'
      - 'flake.nix'
      - 'flake.lock'
    cmds:
      - echo "üîç Dry run nix-darwin deployment..."
      - darwin-rebuild build --flake .
      - echo "‚úÖ Dry run complete!"

  deploy:dry-run:home:
    desc: Dry run home-manager deployment
    sources:
      - 'home/**/*.nix'
      - 'modules/home-manager/**/*.nix'
      - 'flake.nix'
      - 'flake.lock'
    cmds:
      - echo "üîç Dry run home-manager deployment..."
      - home-manager build --flake .
      - echo "‚úÖ Dry run complete!"
